
/*!
 * angular-popbox - Angular directive for popbox plugin
 * v0.2.1
 * https://github.com/firstandthird/angular-popbox
 * copyright First + Third 2013
 * MIT License
*/
!function(a,b){var c=0,d=function(a){this.obj=a};d.prototype.__init=function(a){b.extend(this,this.obj),this.id=c++,this.obj.defaults=this.obj.defaults||{},b.extend(this,this.obj.defaults,a),b("body").trigger("FidelPreInit",this),this.setElement(this.el||b("<div/>")),this.init&&this.init(),b("body").trigger("FidelPostInit",this)},d.prototype.eventSplitter=/^(\w+)\s*(.*)$/,d.prototype.setElement=function(a){this.el=a,this.getElements(),this.delegateEvents(),this.dataElements(),this.delegateActions()},d.prototype.find=function(a){return this.el.find(a)},d.prototype.proxy=function(a){return b.proxy(a,this)},d.prototype.getElements=function(){if(this.elements)for(var a in this.elements){var b=this.elements[a];this[b]=this.find(a)}},d.prototype.dataElements=function(){var a=this;this.find("[data-element]").each(function(c,d){var e=b(d),f=e.data("element");a[f]=e})},d.prototype.delegateEvents=function(){if(this.events)for(var a in this.events){var b=this.events[a],c=a.match(this.eventSplitter),d=c[1],e=c[2],f=this.proxy(this[b]);""===e?this.el.on(d,f):this[e]&&"function"!=typeof this[e]?this[e].on(d,f):this.el.on(d,e,f)}},d.prototype.delegateActions=function(){var a=this;a.el.on("click","[data-action]",function(c){var d=b(this),e=d.attr("data-action");a[e]&&a[e](c,d)})},d.prototype.on=function(a,b){this.el.on(a+".fidel"+this.id,b)},d.prototype.one=function(a,b){this.el.one(a+".fidel"+this.id,b)},d.prototype.emit=function(a,b,c){var d=c?".fidel"+this.id:"";this.el.trigger(a+d,b)},d.prototype.hide=function(){if(this.views)for(var a in this.views)this.views[a].hide();this.el.hide()},d.prototype.show=function(){if(this.views)for(var a in this.views)this.views[a].show();this.el.show()},d.prototype.destroy=function(){this.el.empty(),this.emit("destroy"),this.el.unbind(".fidel"+this.id)},d.declare=function(a){var b=function(a,b){this.__init(a,b)};return b.prototype=new d(a),b},d.onPreInit=function(a){b("body").on("FidelPreInit",function(b,c){a.call(c)})},d.onPostInit=function(a){b("body").on("FidelPostInit",function(b,c){a.call(c)})},a.Fidel=d}(window,window.jQuery||window.Zepto),function(a){a.declare=function(b,c){a.fn[b]=function(){var d,e,f=Array.prototype.slice.call(arguments),g=f.shift();return e=this.each(function(){var e=a(this),h=e.data(b);if(!h){var i=Fidel.declare(c),j=a.extend({},g,{el:e});h=new i(j),e.data(b,h)}"string"==typeof g&&(d=h[g].apply(h,f))}),"undefined"!=typeof d?d:e},a.fn[b].defaults=c.defaults||{}},a.Fidel=window.Fidel}(jQuery),function(a){a.declare("popbox",{defaults:{containerClass:"popbox",direction:"down",directionOffset:10,hideFadeDuration:100,showFadeDuration:50,hideTimeout:100,enableHover:!0,clickToShow:!0},init:function(){this.open=!1,this.hoveringOverTooltip=!1,this.hideTimer=null,this.text=this.el.data("popbox-text")||"",this.title=this.el.data("popbox-title")||"",this.templateEl=this.el.data("popbox-el")||"",this.direction=this.el.data("popbox-direction")||this.direction,this.template="",this.attachEvents()},isOpen:function(){return this.open},attachEvents:function(){this.enableHover&&(this.el.bind("mouseenter",this.proxy(this.show)),this.el.bind("mouseleave",this.proxy(this.hide)))},reset:function(){this.template.unbind("mouseenter"),this.template.unbind("mouseleave"),this.template.remove()},show:function(b){this.hoveringOverTooltip||"undefined"!=typeof b&&this.forcedOpen||("undefined"==typeof b&&(this.forcedOpen=!0),clearTimeout(this.hideTimer),this.open||(a("body").append(this.generateTemplate()),this.template.bind("mouseenter",this.proxy(this.hoverTooltip)),this.template.bind("mouseleave",this.proxy(this.hoverLeaveTooltip)),this.template.hide().fadeIn(this.showFadeDuration),this.position()),this.open=!0,this.el.trigger("show"))},hide:function(a){this.hoveringOverTooltip||this.open&&("undefined"!=typeof a&&this.forcedOpen||("undefined"==typeof a&&(this.forcedOpen=!1),this.hideTimer=setTimeout(this.proxy(function(){this.template.fadeOut(this.hideFadeDuration,this.proxy(this.reset)),this.open=!1,this.hoveringOverTooltip=!1,this.el.trigger("hide")}),this.hideTimeout)))},toggle:function(a){return this.clickToShow?(this.open?this.hide(a):this.show(a),!1):void 0},position:function(){this.template.css({position:"absolute"});var a=this.el.offset();switch(this.direction){case"left":this.template.css({left:a.left-this.template.outerWidth()-this.directionOffset,top:a.top+this.el.outerHeight()/2-this.template.outerHeight()/2}),this.template.addClass("left");break;case"up":this.template.css({left:a.left+this.el.outerWidth()/2-this.template.outerWidth()/2,top:a.top-this.template.outerHeight()-this.directionOffset}),this.template.addClass("up");break;case"right":this.template.css({left:a.left+this.el.outerWidth()+this.directionOffset,top:a.top+this.el.outerHeight()/2-this.template.outerHeight()/2}),this.template.addClass("right");break;case"down":this.template.css({left:a.left+this.el.outerWidth()/2-this.template.outerWidth()/2,top:a.top+this.el.outerHeight()+this.directionOffset}),this.template.addClass("down");break;case"left-up":this.template.css({left:a.left-this.template.outerWidth()/2,top:a.top-this.template.outerHeight()-this.directionOffset}),this.template.addClass("left-up");break;case"right-up":this.template.css({left:a.left+this.el.outerWidth()-this.template.outerWidth()/2,top:a.top-this.template.outerHeight()-this.directionOffset}),this.template.addClass("right-up")}},generateTemplate:function(){if(this.template)return this.template;var b=a(document.createElement("div")),c=a(document.createElement("div")),d=a(document.createElement("div"));return b.addClass(this.containerClass),this.templateEl?b.append(a(this.templateEl).html()):(this.title&&(c.addClass("title"),c.html(this.title),b.append(c)),this.text&&(d.addClass("text"),d.html(this.text),b.append(d))),this.template=b,this.template},hoverTooltip:function(){clearTimeout(this.hideTimer),this.hoveringOverTooltip=!0},hoverLeaveTooltip:function(){this.hoveringOverTooltip=!1,this.el.trigger("mouseleave")}}),a.popboxDisableAutoAPI||a("[data-popbox]").popbox()}(jQuery),angular.module("ftPopbox",[]).directive("popbox",function(){return{restrict:"A",link:function(a,b,c){var d,e=$(b),f=c.popboxDirection||"down",g=function(a){console.log(arguments),d.text=a,d.template=null};e.popbox({direction:f}),d=e.data("popbox"),c.$observe("popbox",function(a){g(a),console.log("update",arguments)})}}});